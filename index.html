<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaiderWatch Schedule Tracker</title>
    <style>
        :root {
            --color-primary: #8b0000; /* Dark Red/Maroon (Raiders Color) */
            --color-secondary: #f0f0f0;
            --color-text: #333;
            --color-background: #ffffff;
            --color-light-gray: #eee;
            --color-dark-gray: #555;
            --color-active: #ffc107; /* Amber/Gold for active state */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--color-background);
            color: var(--color-text);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: var(--color-secondary);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        h1 {
            color: var(--color-primary);
            text-align: center;
            margin-bottom: 5px;
            font-size: 1.8em;
        }

        #day-display {
            text-align: center;
            font-size: 1.1em;
            color: var(--color-dark-gray);
            margin-bottom: 20px;
        }

        /* --- Main Display Area --- */
        #main-display {
            margin-bottom: 25px;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: var(--color-light-gray);
        }

        .period-status {
            padding: 15px;
            border-radius: 6px;
            color: white;
            transition: background-color 0.3s;
        }

        .period-status h2 {
            margin: 0;
            font-size: 1.7em;
            font-weight: 600;
        }

        .period-status p {
            margin: 5px 0 0;
            font-size: 1em;
        }

        .period-status.no-school { background-color: #007bff; }
        .period-status.before-school { background-color: #4a90e2; }
        .period-status.after-school { background-color: #7f8c8d; }
        .period-status.meeting, .period-status.advisory { background-color: #f39c12; }
        .period-status.lunch { background-color: #2ecc71; }
        .period-status.study, .period-status.late-start, .period-status.info { background-color: #9b59b6; }
        .period-status.passing { background-color: #34495e; }
        .period-status.no-period { background-color: #c0392b; }

        /* Specific Color Classes */
        .period-red { background-color: #e74c3c; }
        .period-orange { background-color: #e67e22; }
        .period-yellow { background-color: #f1c40f; color: #333; }
        .period-green { background-color: #27ae60; }
        .period-light-blue { background-color: #3498db; }
        .period-royal-blue { background-color: #2980b9; }
        .period-purple { background-color: #8e44ad; }
        
        .remaining-time {
            font-size: 1.5em !important;
            font-weight: 700;
            margin-top: 10px !important;
        }

        /* --- Full Schedule List --- */
        #period-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #period-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            opacity: 0.8;
            transition: opacity 0.3s, transform 0.3s;
        }

        #period-list li.active {
            opacity: 1;
            transform: scale(1.02);
            border: 2px solid var(--color-active);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
        }

        .period-name {
            font-weight: 600;
        }

        .period-time {
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.15);
            padding: 3px 8px;
            border-radius: 4px;
        }

        /* --- Settings/Late Lunch Controls --- */
        .settings-container {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--color-light-gray);
            text-align: center;
        }

        .settings-container h3 {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .late-lunch-toggles {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .late-lunch-toggle {
            background-color: var(--color-light-gray);
            color: var(--color-dark-gray);
            border: 2px solid var(--color-dark-gray);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            font-size: 0.9em;
            font-weight: 500;
        }

        .late-lunch-toggle.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .late-lunch-toggle:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>RaiderWatch âŒš</h1>
        <div id="day-display">Loading...</div>

        <div id="main-display">
            </div>

        <h2>Today's Schedule</h2>
        <ul id="period-list">
            </ul>

        <div class="settings-container">
            <h3>Late Lunch Toggle (Standard Days Only)</h3>
            <div class="late-lunch-toggles">
                <button class="late-lunch-toggle" data-day="1">Mon</button>
                <button class="late-lunch-toggle" data-day="2">Tue</button>
                <button class="late-lunch-toggle" data-day="3">Wed</button>
                <button class="late-lunch-toggle" data-day="4">Thu</button>
                <button class="late-lunch-toggle" data-day="5">Fri</button>
            </div>
        </div>
    </div>

    <script>
        class RaiderWatch {
            constructor() {
                this.settings = this.loadSettings();
                this.schedules = {
                    // Day 1: Monday (Standard)
                    1: [
                        { period: 'Red', start: '08:45', end: '09:30', color: 'period-red', type: 'class' },
                        { period: 'Passing Period', start: '09:30', end: '09:35', color: '', type: 'passing' },
                        { period: 'Orange', start: '09:35', end: '10:20', color: 'period-orange', type: 'class' },
                        { period: 'Passing Period', start: '10:20', end: '10:35', color: '', type: 'passing' },
                        { period: 'Yellow', start: '10:35', end: '11:20', color: 'period-yellow', type: 'class' },
                        { period: 'Passing Period', start: '11:20', end: '11:25', color: '', type: 'passing' },
                        { period: 'Green', start: '11:25', end: '12:10', color: 'period-green', type: 'class' },
                        { period: 'Lunch', start: '12:10', end: '12:55', color: '', type: 'lunch' },
                        { period: 'Light Blue', start: '12:55', end: '13:40', color: 'period-light-blue', type: 'class' },
                        { period: 'Passing Period', start: '13:40', end: '13:45', color: '', type: 'passing' },
                        { period: 'Royal Blue', start: '13:45', end: '14:30', color: 'period-royal-blue', type: 'class' },
                        { period: 'Passing Period', start: '14:30', end: '14:35', color: '', type: 'passing' },
                        { period: 'Purple', start: '14:35', end: '15:20', color: 'period-purple', type: 'class' }
                    ],
                    // Day 2: Tuesday (Standard Schedule - RESTORED)
                    2: [
                        { period: 'Yellow', start: '08:45', end: '10:00', color: 'period-yellow', type: 'class' },
                        { period: 'Morning Meetings', start: '10:00', end: '10:15', color: '', type: 'meeting' },
                        { period: 'Meetings', start: '10:15', end: '10:45', color: '', type: 'meeting' },
                        { period: 'Orange', start: '10:45', end: '12:00', color: 'period-orange', type: 'class' },
                        { period: 'Lunch', start: '12:00', end: '12:45', color: '', type: 'lunch' },
                        { period: 'Red', start: '12:45', end: '14:00', color: 'period-red', type: 'class' },
                        { period: 'Passing Period', start: '14:00', end: '14:05', color: '', type: 'passing' },
                        { period: 'Advisory', start: '14:05', end: '14:20', color: '', type: 'advisory' },
                        { period: 'Raider Hour', start: '14:20', end: '15:20', color: '', type: 'study' }
                    ],
                    // Day 3: Wednesday (Standard)
                    3: [
                        { period: 'Light Blue', start: '08:45', end: '10:00', color: 'period-light-blue', type: 'class' },
                        { period: 'Meetings', start: '10:00', end: '10:45', color: '', type: 'meeting' },
                        { period: 'Green', start: '10:45', end: '12:00', color: 'period-green', type: 'class' },
                        { period: 'Lunch', start: '12:00', end: '12:45', color: '', type: 'lunch' },
                        { period: 'Purple', start: '12:45', end: '14:00', color: 'period-purple', type: 'class' },
                        { period: 'Passing Period', start: '14:00', end: '14:05', color: '', type: 'passing' },
                        { period: 'Royal Blue', start: '14:05', end: '15:20', color: 'period-royal-blue', type: 'class' }
                    ],
                    // Day 4: Thursday (Standard)
                    4: [
                        { period: 'Late Start', start: '08:45', end: '10:00', color: '', type: 'late-start' },
                        { period: 'Red', start: '10:00', end: '11:15', color: 'period-red', type: 'class' },
                        { period: 'Morning Meetings', start: '11:15', end: '11:30', color: '', type: 'meeting' },
                        { period: 'Meetings', start: '11:30', end: '12:00', color: '', type: 'meeting' },
                        { period: 'Lunch', start: '12:00', end: '12:45', color: '', type: 'lunch' },
                        { period: 'Orange', start: '12:45', end: '14:00', color: 'period-orange', type: 'class' },
                        { period: 'Passing Period', start: '14:00', end: '14:05', color: '', type: 'passing' },
                        { period: 'Yellow', start: '14:05', end: '15:20', color: 'period-yellow', type: 'class' }
                    ],
                    // Day 5: Friday (Standard)
                    5: [
                        { period: 'Royal Blue', start: '08:45', end: '10:00', color: 'period-royal-blue', type: 'class' },
                        { period: 'Advisory', start: '10:00', end: '10:25', color: '', type: 'advisory' },
                        { period: 'Meetings', start: '10:25', end: '10:45', color: '', type: 'meeting' },
                        { period: 'Purple', start: '10:45', end: '12:00', color: 'period-purple', type: 'class' },
                        { period: 'Lunch', start: '12:00', end: '12:45', color: '', type: 'lunch' },
                        { period: 'Green', start: '12:45', end: '14:00', color: 'period-green', type: 'class' },
                        { period: 'Passing Period', start: '14:00', end: '14:05', color: '', type: 'passing' },
                        { period: 'Light Blue', start: '14:05', end: '15:20', color: 'period-light-blue', type: 'class' }
                    ]
                };

                // ONE-TIME special schedule override for 12/02/2025
                this.specialSchedules = {
                    '12/02/2025': [
                        { period: 'Tuesday, December 2nd Late Start', start: '08:45', end: '10:00', color: '', type: 'info' },
                        { period: 'YELLOW', start: '10:00', end: '11:15', color: 'period-yellow', type: 'class' },
                        { period: 'Passing Period', start: '11:15', end: '11:20', color: '', type: 'passing' },
                        { period: 'MORNING MEETING - JanTerm Walkthru', start: '11:20', end: '12:00', color: '', type: 'meeting' },
                        // Lunch/Orange Class Block (12:00 - 2:00)
                        { period: 'Lunch (Early)', start: '12:00', end: '12:45', color: '', type: 'lunch' },
                        { period: 'ORANGE (Early Class)', start: '12:05', end: '12:45', color: 'period-orange', type: 'class', isLateLunchClass: true },
                        { period: 'ORANGE (Late Class)', start: '12:45', end: '2:00', color: 'period-orange', type: 'class', isLateLunchClass: true },
                        { period: 'Lunch (Late)', start: '12:45', end: '1:25', color: '', type: 'lunch' },
                        { period: 'ORANGE (Late Class Cont.)', start: '1:25', end: '2:00', color: 'period-orange', type: 'class', isLateLunchClass: true },
                        // End Lunch/Orange Block
                        { period: 'Passing Period', start: '2:00', end: '2:05', color: '', type: 'passing' },
                        { period: 'RED', start: '2:05', end: '3:20', color: 'period-red', type: 'class' }
                    ]
                };

                this.init();
            }

            loadSettings() {
                try {
                    const settings = JSON.parse(localStorage.getItem('raiderWatchSettings'));
                    return settings || {
                        lateLunchDays: { 1: false, 2: false, 3: false, 4: false, 5: false }
                    };
                } catch (e) {
                    console.error("Error loading settings:", e);
                    return { lateLunchDays: { 1: false, 2: false, 3: false, 4: false, 5: false } };
                }
            }

            saveSettings() {
                localStorage.setItem('raiderWatchSettings', JSON.stringify(this.settings));
                this.updateDisplay();
            }

            init() {
                this.setupEventListeners();
                this.updateDisplay();
                // Update every 5 seconds
                setInterval(() => this.updateDisplay(), 5000); 
            }

            setupEventListeners() {
                const lateLunchToggles = document.querySelectorAll('.late-lunch-toggle');
                lateLunchToggles.forEach(toggle => {
                    toggle.addEventListener('click', (e) => {
                        const day = e.target.getAttribute('data-day');
                        if (day && !e.target.disabled) { // Check if not disabled by special schedule
                            this.settings.lateLunchDays[day] = !this.settings.lateLunchDays[day];
                            this.saveSettings();
                        }
                    });
                    // Initialize button state
                    const day = toggle.getAttribute('data-day');
                    if (day && this.settings.lateLunchDays[day]) {
                        toggle.classList.add('active');
                    }
                });
            }

            getDayType(dayOfWeek) {
                // Monday=1, Tuesday=2, ..., Friday=5
                return dayOfWeek >= 1 && dayOfWeek <= 5 ? dayOfWeek : null;
            }

            getCurrentSchedule() {
                const now = new Date();
                const dayOfWeek = now.getDay();
                const dayType = this.getDayType(dayOfWeek);
                
                if (!dayType || dayOfWeek === 0 || dayOfWeek === 6) {
                    return null; // Weekend or invalid day
                }

                // --- Check for a special schedule override first ---
                // Get date in MM/DD/YYYY format and remove leading zeros for match: M/D/YYYY
                const dateKey = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' }).replace(/\//g, '/');
                const dateKeyClean = dateKey.replace(/^0|(?<=\/)0/g, ''); 
                
                // Use a standard date format key for lookup: '12/2/2025'
                const specialSchedule = this.specialSchedules[dateKeyClean];

                if (specialSchedule) {
                    return { schedule: specialSchedule, dayType: 'special', dayOfWeek };
                }
                // --- End Special Schedule Check ---
                
                // Fall back to standard schedules
                let schedule = [...this.schedules[dayType]];
                
                // Placeholder for applying Late Lunch modification if necessary 
                // (requires defined standard A/B lunch structure)
                if (this.settings.lateLunchDays[dayType]) {
                    schedule = this.applyLateLunch(schedule, dayType);
                }
                
                return { schedule, dayType, dayOfWeek };
            }

            applyLateLunch(schedule, dayType) {
                // Since the standard Day 2 schedule doesn't have an A/B lunch split defined,
                // this is left as a placeholder. In a real application, you would swap the periods here.
                return schedule;
            }

            getCurrentPeriod(schedule) {
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes(); // Minutes since midnight

                for (const period of schedule) {
                    const startTimeParts = period.start.split(':').map(Number);
                    const endTimeParts = period.end.split(':').map(Number);

                    const startMinutes = startTimeParts[0] * 60 + startTimeParts[1];
                    const endMinutes = endTimeParts[0] * 60 + endTimeParts[1];

                    // Check if current time is within the period start and end times
                    if (currentTime >= startMinutes && currentTime < endMinutes) {
                        return { ...period, remainingTime: endMinutes - currentTime };
                    }
                }

                // Check if before the first period
                if (schedule.length > 0) {
                    const firstPeriodStartParts = schedule[0].start.split(':').map(Number);
                    const firstPeriodStartMinutes = firstPeriodStartParts[0] * 60 + firstPeriodStartParts[1];
                    if (currentTime < firstPeriodStartMinutes) {
                        return { period: 'Before School', start: '00:00', end: schedule[0].start, color: '', type: 'before-school', remainingTime: firstPeriodStartMinutes - currentTime };
                    }
                }
                
                // Check if after the last period
                if (schedule.length > 0) {
                    const lastPeriod = schedule[schedule.length - 1];
                    const lastPeriodEndParts = lastPeriod.end.split(':').map(Number);
                    const lastPeriodEndMinutes = lastPeriodEndParts[0] * 60 + lastPeriodEndParts[1];
                    if (currentTime >= lastPeriodEndMinutes) {
                        return { period: 'After School', start: lastPeriod.end, end: '23:59', color: '', type: 'after-school', remainingTime: 0 };
                    }
                }

                return null;
            }

            updateDisplay() {
                const scheduleInfo = this.getCurrentSchedule();
                const mainDisplay = document.getElementById('main-display');
                const periodList = document.getElementById('period-list');
                const dayDisplay = document.getElementById('day-display');
                const lateLunchToggles = document.querySelectorAll('.late-lunch-toggle');

                if (!scheduleInfo) {
                    mainDisplay.innerHTML = `
                        <div class="period-status no-school">
                            <h2>It's the Weekend! ðŸ¥³</h2>
                            <p>Enjoy your break. RaiderWatch will resume on Monday.</p>
                        </div>
                    `;
                    dayDisplay.textContent = 'Weekend';
                    periodList.innerHTML = '';
                    lateLunchToggles.forEach(toggle => toggle.disabled = true);
                    return;
                }

                const currentPeriod = this.getCurrentPeriod(scheduleInfo.schedule);
                
                // Update Day Display
                const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                let dayName = dayNames[scheduleInfo.dayOfWeek];
                
                if (scheduleInfo.dayType === 'special') {
                    dayName = `**Today: ${dayName}, ${scheduleInfo.schedule[0].period}**`;
                    lateLunchToggles.forEach(toggle => {
                        toggle.disabled = true;
                        toggle.classList.remove('active');
                    });
                } else {
                    dayName = `Today is ${dayName}`;
                    lateLunchToggles.forEach(toggle => {
                        const day = toggle.getAttribute('data-day');
                        toggle.disabled = false;
                        toggle.classList.toggle('active', this.settings.lateLunchDays[day]);
                    });
                }
                dayDisplay.innerHTML = dayName;


                // Update Main Display
                if (currentPeriod) {
                    const remainingMinutes = currentPeriod.remainingTime;
                    const hours = Math.floor(remainingMinutes / 60);
                    const minutes = remainingMinutes % 60;
                    
                    let remainingText = '';
                    if (currentPeriod.type !== 'after-school') {
                        if (remainingMinutes > 0) {
                             remainingText = `Ends in ${hours > 0 ? hours + ' hr ' : ''}${minutes} min`;
                        } else {
                            remainingText = 'Time\'s up! Next period starting soon.';
                        }
                    } else {
                        remainingText = 'Classes are over for the day. See you tomorrow!';
                    }


                    mainDisplay.innerHTML = `
                        <div class="period-status ${currentPeriod.color || currentPeriod.type}">
                            <h2>${currentPeriod.period}</h2>
                            <p class="time-range">${currentPeriod.start} - ${currentPeriod.end}</p>
                            <p class="remaining-time">${remainingText}</p>
                        </div>
                    `;
                } else {
                    mainDisplay.innerHTML = `
                        <div class="period-status no-period">
                            <h2>No Active Period</h2>
                            <p>Check the schedule below.</p>
                        </div>
                    `;
                }

                // Update Period List
                periodList.innerHTML = scheduleInfo.schedule.map(p => {
                    const isActive = currentPeriod && p.period === currentPeriod.period;
                    return `
                        <li class="${isActive ? 'active' : ''} ${p.color || p.type}">
                            <span class="period-name">${p.period}</span>
                            <span class="period-time">${p.start} - ${p.end}</span>
                        </li>
                    `;
                }).join('');
            }
        }

        // Initialize the application once the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof RaiderWatch !== 'undefined') {
                new RaiderWatch();
            }
        });
    </script>
</body>
</html>
